@model Booking
@{
    ViewData["Title"] = "Rent Car";
}

@if (TempData["ErrorMessage"] != null)
{
    <script>
        alert("@TempData["ErrorMessage"]");
    </script>
}

<section class="site-section contact-area section--padding position-relative" style="margin-bottom:0px; margin-top:30px">
    <span class="ring-shape ring-shape-1"></span>
    <span class="ring-shape ring-shape-2"></span>
    <span class="ring-shape ring-shape-3"></span>
    <span class="ring-shape ring-shape-4"></span>
    <span class="ring-shape ring-shape-5"></span>
    <span class="ring-shape ring-shape-6"></span>
    <span class="ring-shape ring-shape-7"></span>
    <div class="container">
        <div class="row">
            <div class="col-lg-7 mx-auto">
                <div class="card card-item">
                    <div class="card-body">
                        <h3 class="card-title text-center fs-24 lh-35 pb-4">Rent Car</h3>
                        <div class="section-block"></div>
                        <form asp-action="RentCar" asp-controller="Booking" method="post" class="mt-3">
                            <div class="row">
                                <!-- Car Details Section -->
                                <div class="row mt-4">
                                    <div class="col-md-6">
                                        <h5>@Model.Car.Brand @Model.Car.Model (@Model.Car.Year)</h5>
                                        <p><strong>Price per Hour:</strong> @Model.Car.DailyRate.ToString("C")</p>
                                        <p><strong>Fuel Type:</strong> @Model.Car.FuelType</p>
                                        <p><strong>Transmission:</strong> @Model.Car.Transmission</p>
                                        <p><strong>Seats:</strong> @Model.Car.Seats</p>
                                        <img src="@Model.Car.Image" alt="Car Image" class="img-fluid" id="carImage" style="cursor: pointer;" />
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label for="StartDate">Start Date</label>
                                            <input type="datetime-local" class="form-control" id="StartDate" name="StartDate" value="@ViewData["StartDate"]" required min="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")" />
                                        </div>
                                        <div class="form-group">
                                            <label for="EndDate">End Date</label>
                                            <input type="datetime-local" class="form-control" id="EndDate" name="EndDate" value="@ViewData["EndDate"]" required min="@DateTime.Now.ToString("yyyy-MM-ddTHH:mm")" />
                                        </div>
                                        <p><strong>Total Price:</strong> <span id="totalPrice">@ViewData["TotalPrice"]</span></p>
                                    </div>
                                </div>

                                <!-- Personal Information Section -->
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="FirstName">First Name</label>
                                        <input type="text" class="form-control" id="FirstName" name="FirstName" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="SecondName">Second Name</label>
                                        <input type="text" class="form-control" id="SecondName" name="SecondName" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-2">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="ThirdName">Third Name</label>
                                        <input type="text" class="form-control" id="ThirdName" name="ThirdName" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="ForthName">Forth Name</label>
                                        <input type="text" class="form-control" id="ForthName" name="ForthName" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-2">
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="Email">Email</label>
                                        <input type="email" class="form-control" id="Email" name="Email" required>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-group">
                                        <label for="PhoneNumber">Mobile Number</label>
                                        <input type="tel" class="form-control" id="PhoneNumber" name="PhoneNumber" required>
                                    </div>
                                </div>
                            </div>

                            <div class="row mt-2">
                                <div class="col-md-12">
                                    <div class="form-group">
                                        <label for="PaymentMethod">Payment Method</label>
                                        <select class="form-control" id="PaymentMethod" name="PaymentMethod" required>
                                            <option value="">Choose Payment Method</option>
                                            <option value="Paypal">PayPal</option>
                                            <option value="Visa">Visa</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <div class="text-center mt-4">
                                <button type="submit" class="btn btn-primary px-4">Rent Car</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Lightbox Modal for image view -->
<div id="imageModal" class="modal" tabindex="-1" role="dialog">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-body">
                <img src="" id="fullImage" class="img-fluid" />
            </div>
        </div>
    </div>
</div>

<script>
    // Show full image when clicked
    document.getElementById("carImage").addEventListener("click", function () {
        var imgSrc = this.src;
        document.getElementById("fullImage").src = imgSrc;
        $('#imageModal').modal('show'); // Show modal with full image
    });

    // Calculate total price based on start date and end date
    document.getElementById("EndDate").addEventListener("change", function () {
        const startDate = new Date(document.getElementById("StartDate").value);
        const endDate = new Date(this.value);

        if (startDate && endDate) {
            const hoursDiff = (endDate - startDate) / 1000 / 3600; // Difference in hours
            const hourlyRate = @Model.Car.DailyRate; // Use the car's hourly rate from model

            if (hoursDiff > 0) {
                const price = hourlyRate * hoursDiff; // Calculate price based on hours
                document.getElementById("totalPrice").textContent = `$${price.toFixed(2)}`;
            }
        }
    });

    // Also calculate price when start date is changed
    document.getElementById("StartDate").addEventListener("change", function () {
        const startDate = new Date(this.value);
        const endDate = new Date(document.getElementById("EndDate").value);

        if (startDate && endDate) {
            const hoursDiff = (endDate - startDate) / 1000 / 3600; // Difference in hours
            const hourlyRate = @Model.Car.DailyRate; // Use the car's hourly rate from model

            if (hoursDiff > 0) {
                const price = hourlyRate * hoursDiff; // Calculate price based on hours
                document.getElementById("totalPrice").textContent = `$${price.toFixed(2)}`;
            }
        }
    });
</script>
